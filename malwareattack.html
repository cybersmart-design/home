<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Incident Response Training ‚Äì Panic Mode</title>
<style>
body {
  margin:0;
  background:#07090e;
  color:#eaeaea;
  font-family:"JetBrains Mono", monospace;
}

button {
  background:#ff4d4d;
  border:none;
  color:#000;
  padding:14px 22px;
  font-size:14px;
  cursor:pointer;
  margin-top:25px;
}
button:hover { opacity:0.85; }

.tutorial {
  max-width:900px;
  margin:60px auto;
  padding:30px;
  line-height:1.6;
}

.tutorial h1 { color:#ffcc00; }
.tutorial h2 { color:#00ff9c; margin-top:35px; }

.warning {
  background:#1a0f12;
  border-left:5px solid #ff4d4d;
  padding:15px;
  margin:25px 0;
}

code {
  background:#020409;
  padding:4px 6px;
  border-radius:4px;
  color:#00ff9c;
}

.simulation {
  display:none;
  height:100vh;
}

.layout {
  display:grid;
  grid-template-columns: 1fr 0.9fr;
  height:100%;
}

/* MOBILE: stack columns */
@media (max-width: 860px) {
  .layout {
    grid-template-columns: 1fr;
  }
}

.main {
  padding:20px;
  border-right:2px solid #2a3248;
}

@media (max-width: 860px) {
  .main {
    border-right: none;
    border-bottom:2px solid #2a3248;
  }
}

.side {
  padding:20px;
  background:#05070b;
}

h1.sim {
  margin-top:0;
  color:#ff4d4d;
  animation:pulse 1.2s infinite;
}
@keyframes pulse { 50% { opacity:0.6; } }

.alert {
  background:#1a0f12;
  border-left:5px solid #ff4d4d;
  padding:12px;
  margin-bottom:15px;
}

/* RESPONSIVE TERMINAL */
.terminal {
  background:#020409;
  border:1px solid #2a3248;
  height: 48vh;           /* responsive */
  max-height: 520px;
  min-height: 280px;
  padding:12px;
  overflow-y:auto;
  font-size:13px;
  line-height:1.35;
}

.input {
  display:flex;
  margin-top:10px;
}
.input span {
  color:#00ff9c;
  margin-right:6px;
}
.input input {
  flex:1;
  background:black;
  color:#eaeaea;
  border:none;
  outline:none;
  font-family:inherit;
  font-size:16px;
  padding:10px;
}

/* METRICS */
.metric {
  margin-bottom:15px;
}
.danger {
  color:#ff4d4d;
  font-weight:bold;
  animation:blink 1s infinite;
}
.success { color:#00ff9c; font-weight:bold; }
.error { color:#ff4d4d; font-weight:bold; }
@keyframes blink { 50% { opacity:0.4; } }

.mode-select {
  display:flex;
  justify-content:space-between;
  margin-top:20px;
}
.mode-select button{
  width:48%;
  padding:12px;
  border:none;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
}
.guided { background:#22c55e; color:white; }
.challenge { background:#ef4444; color:white; }

/* GUIDED PANEL */
.guided-panel {
  background:#0a0c11;
  border:1px solid #2a3248;
  padding:15px;
  margin-top:15px;
}
.guided-panel h3 { margin:0 0 10px 0; color:#00ff9c; }
.guided-panel p { margin:6px 0; }
.guided-panel .hint { color:#c9d1d9; }
.guided-panel .next { color:#00ff9c; font-weight:bold; }
.guided-panel .step { color:#ffcc00; }

/* POPUP */
.popup-bg {
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.65);
  display:none;
  justify-content:center;
  align-items:center;
}
.popup {
  background:#0a0c11;
  border:1px solid #2a3248;
  padding:25px;
  width:90%;
  max-width:450px;
  text-align:center;
}
.popup h2 { margin:0 0 10px 0; color:#00ff9c; }
.popup p { margin:10px 0; }

.popup .btns {
  margin-top:15px;
  display:flex;
  justify-content:space-between;
}
.popup .btns button {
  width:48%;
  margin:0 1%;
  padding:12px;
  border:none;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
}
.btn-try { background:#22c55e; color:#000; }
.btn-exit { background:#ff4d4d; color:#000; }
</style>
</head>

<body>

<!-- ================= TUTORIAL ================= -->
<div class="tutorial" id="tutorial">
<h1>üõ° Incident Response Training ‚Äì Briefing</h1>
<p>You are about to enter a live incident response simulation. Apply the correct commands under pressure.</p>
<div class="warning">Safe simulation. Delays and incorrect actions increase impact.</div>

<h2>Commands</h2>
<ul>
<li><code>apply containment</code> ‚Äì Stop malware spread</li>
<li><code>isolate endpoint</code> ‚Äì Disconnect infected system</li>
<li><code>scan system</code> ‚Äì Analyze malware</li>
<li><code>identify threat</code> ‚Äì Confirm malware type</li>
<li><code>quarantine threat</code> ‚Äì Partial containment</li>
<li><code>eradicate threat</code> ‚Äì Remove malware</li>
<li><code>backup data</code> ‚Äì Save files</li>
<li><code>recover system</code> ‚Äì Restore system</li>
<li><code>check logs</code> ‚Äì View activity clues</li>
<li><code>notify team</code> ‚Äì Alert SOC</li>
<li><code>help</code> ‚Äì Show guidance</li>
</ul>

<div class="mode-select">
  <button class="guided" onclick="setMode('guided')">Guided Mode</button>
  <button class="challenge" onclick="setMode('challenge')">Challenge Mode</button>
</div>
</div>

<!-- ================= SIMULATION ================= -->
<div class="simulation" id="simulation">
<div class="layout">
<div class="main">
<h1 class="sim">üö® ACTIVE RANSOMWARE INCIDENT</h1>
<div class="alert">Endpoint <strong>WS-23</strong> is encrypting files.</div>
<div class="terminal" id="terminal"></div>
<div class="input"><span>&gt;</span><input id="cmd" placeholder="type a command" autofocus/></div>
</div>

<!-- SIDE PANEL -->
<div class="side">
<div class="metric">‚è± Time Remaining:<br><span class="danger" id="timer">02:00</span></div>
<div class="metric">üìâ Files Affected:<br><span class="danger" id="files">37</span></div>
<div class="metric">üåê Network:<br><span id="net">CONNECTED</span></div>
<div class="metric">ü¶† Threat Status:<br><span id="status">ACTIVE</span></div>

<!-- GUIDED PANEL (hidden in challenge mode) -->
<div id="guidedPanel" class="guided-panel" style="display:none;">
  <h3>Guided Mode</h3>
  <p class="hint">Step <span class="step" id="stepNum">1</span> / 8</p>
  <p class="hint">Next command:</p>
  <p class="next" id="nextCmd">apply containment</p>
  <p class="hint">Tip: Follow steps in order. If you type wrong, you'll receive a hint.</p>
</div>
</div>
</div>
</div>

<!-- POPUP -->
<div class="popup-bg" id="popupBg">
  <div class="popup" id="popup">
    <h2 id="popupTitle">Simulation Complete</h2>
    <p id="popupMsg">You successfully resolved the incident.</p>
    <div class="btns">
      <button class="btn-try" onclick="tryAgain()">Try Again</button>
      <button class="btn-exit" onclick="exitSim()">Exit</button>
    </div>
  </div>
</div>

<script>
let mode = null;

function setMode(m){
  mode = m;
  document.getElementById("tutorial").style.display="none";
  document.getElementById("simulation").style.display="block";
  document.getElementById("guidedPanel").style.display = (mode === "guided") ? "block" : "none";
  initSim();
}

function initSim(){
  const term = document.getElementById("terminal");
  const cmd = document.getElementById("cmd");
  const timerEl = document.getElementById("timer");
  const filesEl = document.getElementById("files");
  const netEl = document.getElementById("net");
  const statusEl = document.getElementById("status");
  const nextCmdEl = document.getElementById("nextCmd");
  const stepNumEl = document.getElementById("stepNum");
  const popupBg = document.getElementById("popupBg");
  const popupTitle = document.getElementById("popupTitle");
  const popupMsg = document.getElementById("popupMsg");

  let time = mode === "challenge" ? 70 : 90;
  let files = 37;
  let failed = false;
  let completed = false;
  let interval;

  const spamLogs = [
    "Updating package list...",
    "Checking repository metadata...",
    "Downloading package info...",
    "Installing dependencies...",
    "Applying security patch...",
    "Verifying signatures...",
    "Updating modules...",
    "Cleaning temporary files...",
    "Checking disk integrity...",
    "Rebuilding cache...",
    "Syncing system time...",
    "Monitoring process status...",
    "Checking firewall rules...",
    "Scanning for anomalies...",
    "Writing log to disk...",
    "Finalizing update..."
  ];

  let alertNoise = mode === "challenge" ? [
    "[ALERT] Unknown process spawned",
    "[EDR] Suspicious memory activity",
    "[FS] Rapid file modification detected",
    "[ALERT] Possible lateral movement",
    "[FS] Ransom note created",
    "[EDR] Process injected into svchost",
    "[ALERT] Admin credentials requested",
    "[EDR] Mass file encryption detected"
  ] : [
    "[ALERT] Unknown process spawned",
    "[EDR] Suspicious memory activity",
    "[FS] Rapid file modification detected",
    "[ALERT] Possible lateral movement",
    "[FS] Ransom note created",
    "[EDR] Process injected into svchost"
  ];

  let state = {
    contained:false, isolated:false, scanned:false,
    identified:false, quarantined:false,
    eradicated:false, backedUp:false
  };

  let guidedStep = 0;
  const guidedSteps = [
    "apply containment",
    "isolate endpoint",
    "scan system",
    "identify threat",
    "quarantine threat",
    "eradicate threat",
    "backup data",
    "recover system"
  ];

  function updateGuidedPanel(){
    if(mode !== "guided") return;
    if(guidedStep >= guidedSteps.length){
      nextCmdEl.textContent = "COMPLETED";
      stepNumEl.textContent = guidedSteps.length;
      return;
    }
    nextCmdEl.textContent = guidedSteps[guidedStep];
    stepNumEl.textContent = (guidedStep + 1);
  }

  function log(msg, type){
    const d = document.createElement("div");
    d.textContent = msg;
    if(type === "success") d.classList.add("success");
    if(type === "error") d.classList.add("error");
    term.appendChild(d);
    term.scrollTop = term.scrollHeight;
  }

  function spamTerminal(){
    let i = 0;
    const sp = setInterval(() => {
      log(spamLogs[i % spamLogs.length]);
      i++;
      if(i > 60) clearInterval(sp);
    }, mode === "challenge" ? 80 : 120);
  }

  function noiseLine(){
    return alertNoise[Math.floor(Math.random()*alertNoise.length)];
  }

  function randomNoise(){
    log(noiseLine(), "error");
  }

  function startTimer(){
    interval = setInterval(()=>{
      time--;
      let dynamicLoss = state.contained ? Math.floor(Math.random()*2+1) : Math.floor(Math.random()*8+5 + (90-time)/10);
      if(mode === "challenge") dynamicLoss += 3;
      if(!state.quarantined) dynamicLoss += 2;
      files += dynamicLoss;

      timerEl.textContent = `0${Math.floor(time/60)}:${String(time%60).padStart(2,"0")}`;
      filesEl.textContent = files;

      if(Math.random() < (mode === "challenge" ? 0.45 : 0.35)) randomNoise();

      if(time <=0){
        clearInterval(interval);
        failed = true;
        showPopup("Failed", "SYSTEM COMPROMISED: Files encrypted.");
      }
    },1000);
  }

  function showPopup(title, msg){
    popupTitle.textContent = title;
    popupMsg.textContent = msg;
    popupBg.style.display = "flex";
    cmd.disabled = true;
  }

  function hidePopup(){
    popupBg.style.display = "none";
  }

  function tryAgain(){
    hidePopup();
    resetSim();
  }

  function exitSim(){
    hidePopup();
    term.innerHTML = "";
    cmd.disabled = true;
    log("‚úî Training session ended.", "success");
  }

  async function showCommandOutput(lines, delay){
    for(let line of lines){
      log(line);
      await new Promise(r => setTimeout(r, delay));
    }
  }

  async function commandResponse(input){
    if(mode === "guided" && input !== guidedSteps[guidedStep] && input !== "help"){
      log("‚ùå Wrong command for this step.", "error");
      log("‚û°Ô∏è Guided Hint: Type `" + guidedSteps[guidedStep] + "`", "success");
      files += 5;
      return;
    }

    switch(input){
      case "help":
        await showCommandOutput([
          "Guided Mode Instructions:",
          "- Follow the next command shown on the right",
          "- Do not skip steps",
          "- Wrong command adds more damage"
        ], 35);
        break;

      case "apply containment":
        guidedStep++; updateGuidedPanel();
        state.contained = true;
        netEl.textContent="DISCONNECTED";
        await showCommandOutput([
          "[INFO] Network isolation initiated...",
          "[INFO] Blocking outbound traffic on WS-23...",
          "[INFO] Containment rules applied successfully.",
          "‚úî Containment applied"
        ], 25);
        break;

      case "isolate endpoint":
        guidedStep++; updateGuidedPanel();
        state.isolated = true;
        netEl.textContent="ISOLATED";
        await showCommandOutput([
          "[INFO] Endpoint isolation started...",
          "[INFO] Disabling network adapter...",
          "[INFO] Endpoint WS-23 is now isolated.",
          "‚úî Endpoint isolated"
        ], 25);
        break;

      case "scan system":
        guidedStep++; updateGuidedPanel();
        state.scanned = true;
        await showCommandOutput([
          "[SCAN] Starting full disk scan...",
          "[SCAN] Detecting suspicious files...",
          "[SCAN] Found 14 encrypted file signatures",
          "[SCAN] Possible ransomware family: LOCKER-X",
          "‚úî Scan completed"
        ], 30);
        break;

      case "identify threat":
        if(!state.contained){
          await showCommandOutput([
            "[ERROR] Threat identification requires containment first.",
            "[ERROR] Ransomware is spreading!"
          ], 25);
          files += 15;
          log("‚ùå Policy violation", "error");
        } else {
          guidedStep++; updateGuidedPanel();
          state.identified = true;
          await showCommandOutput([
            "[INFO] Correlating threat data...",
            "[INFO] Confirmed ransomware: LOCKER-X",
            "‚úî Threat identified"
          ], 25);
        }
        break;

      case "quarantine threat":
        guidedStep++; updateGuidedPanel();
        state.quarantined = true;
        await showCommandOutput([
          "[INFO] Quarantining malicious processes...",
          "[INFO] Blocking ransomware executable...",
          "‚úî Threat quarantined"
        ], 25);
        break;

      case "eradicate threat":
        if(!state.identified || !state.scanned){
          await showCommandOutput([
            "[ERROR] Eradication failed: Threat not fully identified.",
            "[ERROR] Ensure scan and identification complete."
          ], 25);
          files += 20;
          log("‚ùå Eradication failed", "error");
        } else {
          guidedStep++; updateGuidedPanel();
          state.eradicated = true;
          statusEl.textContent="NEUTRALIZED";
          await showCommandOutput([
            "[INFO] Removing ransomware files...",
            "[INFO] Killing malicious processes...",
            "[INFO] Cleaning registry artifacts...",
            "‚úî Threat eradicated"
          ], 25);
        }
        break;

      case "backup data":
        guidedStep++; updateGuidedPanel();
        state.backedUp = true;
        await showCommandOutput([
          "[INFO] Starting backup...",
          "[INFO] Copying files to secure storage...",
          "[INFO] Backup completed successfully.",
          "‚úî Backup complete"
        ], 25);
        break;

      case "recover system":
        if(!state.eradicated){
          await showCommandOutput([
            "[ERROR] Recovery failed: Threat still active.",
            "‚úî Eradicate threat before recovery."
          ], 25);
        } else {
          guidedStep++; updateGuidedPanel();
          await showCommandOutput([
            "[INFO] Restoring system from backup...",
            "[INFO] Verifying file integrity...",
            "‚úÖ Recovery successful"
          ], 25);
          clearInterval(interval);
          completed = true;
          showPopup("Success", "Threat resolved. System recovered.");
        }
        break;

      case "check logs":
        await showCommandOutput([
          "[LOG] 10:12:03 - File modification spike",
          "[LOG] 10:12:07 - Ransom note created",
          "[LOG] 10:12:12 - Outbound traffic detected",
          "[LOG] 10:12:20 - Lateral movement attempt",
          "üîç Logs show rapid encryption and network activity."
        ], 25);
        break;

      case "notify team":
        await showCommandOutput([
          "[INFO] Sending incident alert to SOC...",
          "[INFO] SOC team acknowledged.",
          "‚úî SOC team notified."
        ], 25);
        break;

      default:
        await showCommandOutput([
          "[ERROR] Unknown command",
          "Tip: type 'help' for a list of commands."
        ], 25);
        files += 10;
        break;
    }
  }

  function resetSim(){
    clearInterval(interval);
    term.innerHTML = "";
    time = mode === "challenge" ? 70 : 90;
    files = 37;
    failed = false;
    completed = false;
    state = {contained:false, isolated:false, scanned:false, identified:false, quarantined:false, eradicated:false, backedUp:false};
    guidedStep = 0;
    netEl.textContent = "CONNECTED";
    statusEl.textContent = "ACTIVE";
    cmd.disabled = false;
    startTimer();
    log("[EDR] Suspicious process detected", "error");
    log("[ALERT] Encryption behavior observed", "error");
    spamTerminal();
    updateGuidedPanel();
  }

  log("[EDR] Suspicious process detected", "error");
  log("[ALERT] Encryption behavior observed", "error");
  spamTerminal();
  startTimer();
  updateGuidedPanel();

  cmd.addEventListener("keydown", async e=>{
    if(e.key !== "Enter") return;
    const input = cmd.value.trim().toLowerCase();
    cmd.value = "";
    log("> "+input, "success");

    if(failed || completed){
      return;
    }

    await commandResponse(input);
  });
}
</script>
</body>
</html>
