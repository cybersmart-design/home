<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Security Awareness Inbox | Advanced Training</title>
<style>
* { box-sizing: border-box; font-family: 'Segoe UI', Arial, sans-serif; }
body { margin: 0; background: #f3f5f8; display: flex; flex-direction: column; height: 100vh; }

.topbar {
  height: 56px;
  background: #0f172a;
  color: white;
  display: flex;
  align-items: center;
  padding: 0 16px;
  flex-shrink: 0;
  gap: 10px;
}

#scoreDisplay {
  background: #1e293b;
  padding: 4px 12px;
  border-radius: 20px;
  color: #5bc0be;
  font-weight: bold;
  border: 1px solid #5bc0be;
  margin-right: 10px;
}

.btn-nav {
  padding: 6px 14px;
  border: 1px solid #475569;
  border-radius: 6px;
  background: #1e293b;
  color: #e2e8f0;
  cursor: pointer;
  font-size: 13px;
  transition: 0.2s;
}
.btn-nav:hover { background: #334155; border-color: #94a3b8; }

.container { display: flex; flex: 1; overflow: hidden; }

.sidebar {
  width: 220px;
  background: white;
  border-right: 1px solid #ddd;
  padding: 12px;
}

.sidebar div {
  padding: 10px 12px;
  border-radius: 6px;
  cursor: pointer;
  margin-bottom: 6px;
  transition: 0.2s;
}

.sidebar .active, .sidebar div:hover { background: #e6ecff; color: #1d4ed8; }

.email-area { flex: 1; display: flex; }

.email-list {
  width: 45%;
  background: white;
  border-right: 1px solid #ddd;
  overflow-y: auto;
}

.email-row {
  display: grid;
  grid-template-columns: 32px 32px 1fr 1fr 70px;
  padding: 12px 10px;
  border-bottom: 1px solid #eee;
  cursor: pointer;
  align-items: center;
}

.email-row.unread { background: #f8fbff; font-weight: bold; }
.email-row:hover { background: #eef3ff; }
.email-row.highlight { background: #fff5b1; border-left: 4px solid #f59e0b; }

.email-hint { display: block; font-size: 11px; color: #ef4444; font-weight: normal; }

.time { font-size: 12px; color: #666; text-align: right; }

.email-view { flex: 1; padding: 24px; background: #fafafa; overflow-y: auto; }

.actions button {
  padding: 10px 16px;
  border: none;
  border-radius: 6px;
  margin-right: 8px;
  cursor: pointer;
  font-weight: bold;
}
.delete { background: #64748b; color: white; }
.report { background: #dc2626; color: white; }

.hacker-log {
    height: 140px;
    background: #0a0a0a;
    color: #00ff41;
    font-family: 'Courier New', monospace;
    padding: 12px;
    font-size: 13px;
    overflow-y: auto;
    border-top: 4px solid #dc2626;
}

.log-entry { margin-bottom: 4px; }
.log-critical { color: #ff4444; font-weight: bold; }

.overlay {
  position: fixed; inset: 0;
  background: rgba(0,0,0,.85);
  display: none; align-items: center; justify-content: center;
  z-index: 1000;
}

.modal {
  background: white;
  padding: 30px;
  width: 95%;
  max-width: 500px;
  border-radius: 12px;
  color: #1e293b;
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
}

.endpoint { text-align: center; }
.endpoint h3 { font-size: 24px; margin-bottom: 10px; }
.stats-box { background: #f1f5f9; padding: 15px; border-radius: 8px; margin: 20px 0; text-align: left; }

.btn-primary { background: #2563eb; color: white; width: 100%; padding: 14px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; }
.btn-secondary { background: #64748b; color: white; width: 100%; padding: 14px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; }

#introOverlay { display: flex; }
</style>
</head>
<body>

<div class="overlay" id="introOverlay">
  <div class="modal">
    <h2 style="color: #1e293b">‚ö† Simulation Mode Selection</h2>
    <p>Select your difficulty. <strong>Challenge Mode</strong> features harder typosquatting and hides hints.</p>
    <button class="btn-primary" onclick="selectMode('guided')">Guided Mode (With Highlights)</button>
    <button class="btn-secondary" onclick="selectMode('challenge')">Challenge Mode (Harder Emails)</button>
  </div>
</div>

<div class="topbar">
  <button class="btn-nav" onclick="window.location.href='solutions.html'">‚Üê Back to Solutions</button>
  <button class="btn-nav" onclick="openModeSelection()">Change Mode</button>
  
  <div style="margin-left: auto; display: flex; align-items: center;">
    <div id="scoreDisplay">Score: 0</div>
    <button class="btn-nav" style="background: #475569;" onclick="resetGame()">Full Reset</button>
  </div>
</div>

<div class="container">
  <div class="sidebar">
    <div class="active" id="inboxTab" onclick="switchFolder('inbox', this)">Inbox</div>
    <div onclick="switchFolder('starred', this)">Starred</div>
    <div onclick="switchFolder('trash', this)">Trash</div>
  </div>

  <div class="email-area">
    <div class="email-list" id="emailList"></div>
    <div class="email-view" id="emailView">
      <p style="padding:40px; text-align:center; color: #64748b;">Select an email to investigate.</p>
    </div>
  </div>
</div>

<div class="hacker-log" id="lootLog">
    <div class="log-entry">[SYSTEM] Monitoring for suspicious activities...</div>
</div>

<div class="overlay" id="popup">
  <div class="modal">
    <h3 id="popupTitle"></h3>
    <p id="popupText" style="margin: 15px 0; line-height: 1.6;"></p>
    <button class="btn-primary" onclick="closeAll()">Continue</button>
  </div>
</div>

<div class="overlay" id="endpoint">
  <div class="modal endpoint">
    <h3 id="endTitle">Simulation Complete</h3>
    <div class="stats-box" id="endStats"></div>
    <button class="btn-primary" id="tryAgainBtn" onclick="resetGame()">Try Again</button>
    <button class="btn-secondary" onclick="window.location.href='solutions.html'">View All Solutions</button>
  </div>
</div>

<script>
// DATA TEMPLATES
const GUIDED_EMAILS = [
    { sender: "IT Helpdesk", realAddr: "support@company-verify.net", subject: "Urgent: Password Reset", body: `<p>Your password expires in 1 hour.</p><p>üëâ <a href="#" onclick="openFakeSite()">Update Now</a></p>`, phishing: true, read: false },
    { sender: "Netflix Billing", realAddr: "support@netflix-payments.net", subject: "Payment Declined", body: `<p>Update card info immediately.</p><p>üëâ <a href="#" onclick="openFakeSite()">Update Card</a></p>`, phishing: true, read: false },
    { sender: "FedEx", realAddr: "no-reply@fedex-parcel-status.com", subject: "Package Pending", body: `<p>Action required for delivery.</p><p>üëâ <a href="#" onclick="openFakeSite()">Track</a></p>`, phishing: true, read: false },
    { sender: "Microsoft", realAddr: "alert@microsoft-security-auth.com", subject: "Security Alert", body: `<p>Login from Russia detected.</p><p>üëâ <a href="#" onclick="openFakeSite()">Secure Now</a></p>`, phishing: true, read: false },
    { sender: "HR Dept", realAddr: "hr@company.com", subject: "2026 Holidays", body: `<p>See attached calendar.</p>`, phishing: false, read: false },
    { sender: "Finance", realAddr: "finance@company.com", subject: "Expense Approval", body: `<p>Your report is approved.</p>`, phishing: false, read: false }
];

const CHALLENGE_EMAILS = [
    { sender: "System Admin", realAddr: "admin@rnicrosoft.com", subject: "Security Patch Required", body: `<p>Critical vulnerability detected in your OS.</p><p>üëâ <a href="#" onclick="openFakeSite()">Install Patch</a></p>`, phishing: true, read: false },
    { sender: "Accounts Payable", realAddr: "billing@paypal-support.co", subject: "Invoice #8821990", body: `<p>Please review the invoice for $499.00.</p><p>üëâ <a href="#" onclick="openFakeSite()">View Invoice</a></p>`, phishing: true, read: false },
    { sender: "Internal HR", realAddr: "hr-portal@compnay.com", subject: "Policy Update", body: `<p>Review the new remote work policy.</p><p>üëâ <a href="#" onclick="openFakeSite()">Review Policy</a></p>`, phishing: true, read: false },
    { sender: "DocuSign", realAddr: "docusign@signatures-online.org", subject: "Sign: Performance Review", body: `<p>You have a new document waiting.</p><p>üëâ <a href="#" onclick="openFakeSite()">Review Document</a></p>`, phishing: true, read: false },
    { sender: "Finance Colleague", realAddr: "finance@company.com", subject: "Meeting Notes", body: `<p>Here are the notes from Tuesday.</p>`, phishing: false, read: false },
    { sender: "IT Support", realAddr: "it-support@company.com", subject: "New Password Policy", body: `<p>New 16-character minimum starts Monday.</p>`, phishing: false, read: false }
];

let mode = "guided";
let score = 0;
let breaches = 0;
let caught = 0;
let totalPhish = 4;
let selectedEmail = null;
let currentFolder = 'inbox';
let folders = { inbox: [], starred: [], trash: [] };

function resetGame() {
    score = 0; breaches = 0; caught = 0; selectedEmail = null; currentFolder = 'inbox';
    folders.starred = []; folders.trash = [];
    document.getElementById('scoreDisplay').innerText = `Score: 0`;
    document.getElementById('lootLog').innerHTML = `<div class="log-entry">[SYSTEM] Session Reset. Monitoring activities...</div>`;
    document.getElementById('emailView').innerHTML = `<p style="padding:40px; text-align:center; color: #64748b;">Select an email to investigate.</p>`;
    closeAll();
    openModeSelection();
}

function openModeSelection() {
  document.getElementById('introOverlay').style.display = 'flex';
}

function selectMode(m) {
  mode = m;
  const template = (mode === 'challenge') ? CHALLENGE_EMAILS : GUIDED_EMAILS;
  folders.inbox = JSON.parse(JSON.stringify(template));
  document.getElementById('introOverlay').style.display = 'none';
  renderList();
}

function renderList() {
  const list = document.getElementById('emailList');
  list.innerHTML = '';
  folders[currentFolder].forEach((email, index) => {
    const row = document.createElement('div');
    row.className = 'email-row ' + (email.read ? '' : 'unread');
    if (mode === 'guided' && email.phishing) row.classList.add('highlight');
    row.innerHTML = `
      <input type="checkbox">
      <div class="star">‚òÖ</div>
      <div>${email.sender} <span class="email-hint">${email.read ? '(' + email.realAddr + ')' : ''}</span></div>
      <div>${email.subject}</div>
      <div class="time">Today</div>
    `;
    row.onclick = () => openEmail(email, index);
    list.appendChild(row);
  });
}

function openEmail(email, index) {
  email.read = true;
  selectedEmail = { email, index };
  renderList();
  document.getElementById('emailView').innerHTML = `
    <h2 style="margin-top:0">${email.subject}</h2>
    <p><strong>From:</strong> ${email.sender} &lt;${email.realAddr}&gt;</p>
    <hr style="border:0; border-top: 1px solid #ddd; margin: 20px 0;">
    <div style="min-height:150px; font-size: 16px;">${email.body}</div>
    <div class="actions">
      <button class="delete" onclick="deleteEmail()">Move to Trash</button>
      <button class="report" onclick="submitReport()">Report as Phishing</button>
    </div>
  `;
}

function logTerm(msg, isCritical = false) {
    const log = document.getElementById('lootLog');
    const entry = document.createElement('div');
    entry.className = isCritical ? 'log-entry log-critical' : 'log-entry';
    entry.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
    log.prepend(entry);
}

function deleteEmail() {
  if (!selectedEmail) return;
  const { email, index } = selectedEmail;
  if(email.phishing) { updateScore(-10); logTerm("THREAT IGNORED: Evidence trashed without report.", true); }
  folders.trash.push(email);
  folders[currentFolder].splice(index,1);
  selectedEmail = null;
  document.getElementById('emailView').innerHTML = `<p style="padding:40px; text-align:center; color: #64748b;">Email moved to trash.</p>`;
  renderList();
  checkCompletion();
}

function submitReport() {
  if (!selectedEmail) return;
  const { email, index } = selectedEmail;
  if (email.phishing) { updateScore(15); caught++; showPopup("Threat Neutralized", "Verified. Phishing attempt blocked."); }
  else { updateScore(-20); logTerm("ALERT: False positive reported.", true); showPopup("False Alarm", "This was a safe email."); }
  folders[currentFolder].splice(index,1);
  selectedEmail = null;
  renderList();
  document.getElementById('emailView').innerHTML = `<p style="padding:40px; text-align:center; color: #64748b;">Investigation closed.</p>`;
  checkCompletion();
}

function openFakeSite() {
  const { index } = selectedEmail;
  updateScore(-40); breaches++;
  logTerm("CRITICAL: Breach detected. Remote access granted.", true);
  folders[currentFolder].splice(index, 1);
  selectedEmail = null;
  renderList();
  document.getElementById('emailView').innerHTML = `<p style="padding:40px; text-align:center; color: #dc2626; font-weight: bold;">‚ö†Ô∏è CONNECTION INTERRUPTED: Source deleted.</p>`;
  showPopup("üö® SYSTEM BREACHED", "The attacker has compromised the system.");
  checkCompletion();
}

function updateScore(pts) {
  score += pts;
  document.getElementById('scoreDisplay').innerText = `Score: ${score}`;
  if (score <= -50) triggerFailure();
}

function showPopup(title, text) {
  document.getElementById('popupTitle').innerText = title;
  document.getElementById('popupText').innerText = text;
  document.getElementById('popup').style.display = 'flex';
}

function closeAll() { document.querySelectorAll('.overlay').forEach(o => o.style.display = 'none'); }

function switchFolder(folder, el) {
  currentFolder = folder;
  document.querySelectorAll('.sidebar div').forEach(d => d.classList.remove('active'));
  el.classList.add('active');
  renderList();
}

function triggerFailure() {
    document.getElementById('endTitle').innerText = "‚ùå CRITICAL SECURITY FAILURE";
    document.getElementById('endStats').innerHTML = `<p><strong>Result:</strong> Risk Level Critical</p><p><strong>Score:</strong> ${score}</p>`;
    document.getElementById('endpoint').style.display = 'flex';
}

function checkCompletion() {
  const remaining = folders.inbox.some(e => e.phishing);
  if (!remaining) {
    document.getElementById('endTitle').innerText = "‚úÖ Simulation Results";
    document.getElementById('endStats').innerHTML = `<p><strong>Caught:</strong> ${caught} / ${totalPhish}</p><p><strong>Final Score:</strong> ${score}</p>`;
    document.getElementById('endpoint').style.display = 'flex';
  }
}

resetGame();
</script>
</body>
</html>
