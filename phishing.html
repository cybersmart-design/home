<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CyberSmart | Forensic_Lab_2026</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Outfit:wght@600;900&display=swap" rel="stylesheet" />
    <style>
        :root {
            --bg: #010409; --accent: #03fc84; --cyan: #09eef5; --red: #ff3e3e;
            --panel: #161b22; --border: #30363d;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; overflow: hidden; height: 100vh; }
        #bgCanvas { position: fixed; top: 0; left: 0; z-index: -1; }

        /* --- 1. TARGETED GLITCH ANIMATIONS --- */
        @keyframes systemJitter {
            0% { transform: translate(0); }
            2% { transform: translate(3px, -1px); }
            4% { transform: translate(-2px, 2px); }
            100% { transform: translate(0); }
        }

        @keyframes textGlitchPulse {
            0% { text-shadow: 2px 0 var(--red), -2px 0 var(--cyan); }
            50% { text-shadow: -2px 0 var(--red), 2px 0 var(--cyan); transform: skew(1deg); }
            100% { text-shadow: 2px 0 var(--red), -2px 0 var(--cyan); }
        }

        .glitch-frame { animation: systemJitter 3s infinite steps(1); }
        .glitch-text { animation: textGlitchPulse 0.12s infinite; font-family: 'JetBrains Mono'; }

        /* --- LAYOUT --- */
        .layout { display: grid; grid-template-columns: 1fr 350px; height: 100vh; padding: 80px 25px 25px 25px; gap: 20px; }
        .workspace-frame { background: #0d1117; display: flex; flex-direction: column; overflow: hidden; border-radius: 8px; border: 1px solid var(--border); }
        .window-header { background: #161b22; padding: 10px 15px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 8px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; background: #30363d; }

        /* --- 2. STABLE INBOX UI --- */
        .inbox-container { display: flex; flex: 1; background: #fff; color: #333; overflow: hidden; position: relative; }
        .inbox-nav { width: 180px; background: #f3f5f8; border-right: 1px solid #ddd; padding: 15px 10px; }
        .nav-link { padding: 10px 15px; border-radius: 6px; cursor: pointer; margin-bottom: 5px; font-size: 14px; color: #444; }
        .nav-link.active { background: #d3e3fd; color: #0b57d0; font-weight: bold; }

        .email-list { width: 45%; border-right: 1px solid #ddd; overflow-y: auto; background: #fff; }
        .email-row { display: grid; grid-template-columns: 30px 30px 1fr 60px; padding: 12px 10px; border-bottom: 1px solid #eee; cursor: pointer; align-items: center; font-size: 13px; color: #333; }
        .email-row.unread { font-weight: bold; background: #f8fbff; }
        .email-row.highlight { background: #fff5b1; border-left: 4px solid #f59e0b; }

        .email-view { flex: 1; padding: 25px; background: #fff; overflow-y: auto; color: #333; }
        .actions { margin-top: 30px; display: flex; gap: 10px; }
        .btn-ui { padding: 8px 16px; border-radius: 4px; border: none; cursor: pointer; font-weight: bold; }
        .btn-trash { background: #64748b; color: #fff; }
        .btn-report { background: #dc2626; color: #fff; }

        /* --- 3. CYBER SIDEBAR --- */
        .sidebar { background: var(--panel); padding: 20px; display: flex; flex-direction: column; border: 1px solid var(--border); }
        .stat-card { border: 1px solid var(--border); padding: 20px; text-align: center; margin-bottom: 20px; font-family: 'JetBrains Mono'; background: #0d1117; }
        .hacker-log { flex: 1; background: #000; border: 1px solid var(--border); padding: 10px; font-size: 11px; color: var(--accent); overflow-y: auto; font-family: 'JetBrains Mono'; }

        /* --- 4. CYBER SELECTION MODAL --- */
        .overlay { position: fixed; inset: 0; background: rgba(1, 4, 9, 0.98); z-index: 1000; display: flex; align-items: center; justify-content: center; }
        .cyber-modal { background: #0d1117; padding: 40px; width: 480px; border: 1px solid var(--cyan); text-align: center; box-shadow: 0 0 50px rgba(9, 238, 245, 0.1); }
        .btn-primary { 
            background: transparent; border: 1px solid var(--border); color: #fff; width: 100%; padding: 16px; 
            font-weight: bold; cursor: pointer; margin-top: 15px; font-family: 'JetBrains Mono'; text-align: left;
        }
        .btn-primary:hover { border-color: var(--cyan); color: var(--cyan); background: rgba(9, 238, 245, 0.05); }
        .hidden { display: none !important; }

        #link-tooltip {
            position: fixed; pointer-events: none; background: #0d1117; color: #fff; padding: 12px;
            font-family: 'JetBrains Mono'; font-size: 11px; border: 1px solid var(--cyan); z-index: 9999; display: none;
        }
    </style>
</head>
<body>

<canvas id="bgCanvas"></canvas>

<div id="link-tooltip">
    <div style="color:var(--cyan); font-size: 10px; margin-bottom: 4px; border-bottom: 1px solid #30363d;">PACKET_SOURCE_URL</div>
    <div id="tooltip-url" style="word-break: break-all; font-weight: bold;"></div>
    <div id="tooltip-desc" style="color: #abb2bf; font-size: 10px; margin-top: 8px;"></div>
</div>

<div class="overlay" id="introOverlay">
    <div class="cyber-modal glitch-frame">
        <h2 class="glitch-text" style="font-size: 24px; color: var(--cyan); margin-bottom: 10px;">SYSTEM_INITIALIZE</h2>
        <p style="color: #4b5563; font-size: 11px; margin-bottom: 30px; letter-spacing: 2px;">SECURE FORENSIC ENVIRONMENT V3.0</p>
        
        <button class="btn-primary" style="border-color: #4b5563; color: #8b949e; margin-bottom: 10px;" onclick="window.location.href='solutions.html'">
            << 00. BACK_TO_HUB
        </button>

        <button class="btn-primary" onclick="initSim('guided')">>> 01. LOAD_GUIDED_PROTOCOL</button>
        <button class="btn-primary" onclick="initSim('challenge')">>> 02. LOAD_CHALLENGE_PROTOCOL</button>
        
        <button id="completeBtn" class="btn-primary" style="border-color: var(--accent); color: var(--accent); display:none;" onclick="window.location.href='solutions.html'">
            >> 03. COMPLETED
        </button>
    </div>
</div>

<div class="layout">
    <main class="workspace-frame" id="mainFrame">
        <div class="window-header">
            <div class="dot"></div><div class="dot"></div><div class="dot" style="background:var(--red)"></div>
            <span style="font-size: 10px; color: #8b949e; font-family: 'JetBrains Mono'; margin-left: 10px;">FORENSIC_INBOX_STABLE</span>
        </div>
        
        <div class="inbox-container">
            <div class="inbox-nav">
                <div class="nav-link active" id="nav-inbox" onclick="switchFolder('inbox')">Inbox</div>
                <div class="nav-link" id="nav-trash" onclick="switchFolder('trash')">Quarantine</div>
            </div>
            <div class="email-list" id="emailList"></div>
            <div class="email-view" id="emailView">
                <div style="height:100%; display:flex; align-items:center; justify-content:center; color: #94a3b8;">Awaiting packet selection...</div>
            </div>
        </div>
    </main>

    <aside class="sidebar glitch-frame" id="sideFrame">
        <div class="stat-card">
            <div style="font-size: 10px; color: var(--cyan); letter-spacing: 2px;">NETWORK_INTEGRITY</div>
            <div id="scoreDisplay" class="glitch-text" style="font-size: 48px; color: var(--accent);">0</div>
        </div>
        <div class="hacker-log" id="lootLog"><div>[READY] Listening for incoming traffic...</div></div>
        
        <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 15px;">
            <button class="btn-primary" style="font-size:11px;" onclick="showReselect()">RESELECT MODE</button>
            <button class="btn-primary" style="font-size:11px; border-color: #4b5563; color: #8b949e;" onclick="window.location.href='solutions.html'">BACK TO HUB</button>
        </div>
    </aside>
</div>

<script>
    const GUIDED_DATA = [
        { id: 1, sender: "IT Help", addr: "admin@corp-verify.net", subject: "Password Reset", body: "Action required. <a href='#' onmouseover='showTooltip(\"http://corp-verify.net/reset\", \"TLD HIJACK: Official site is .com, not .net\")' onmouseout='hideTooltip()' onclick='breach()'>Reset Now</a>", phishing: true },
        { id: 2, sender: "HR Dept", addr: "hr@company.com", subject: "Holiday Policy", body: "View the 2026 schedule.", phishing: false }
    ];

    const CHALLENGE_DATA = [
        { id: 101, sender: "CEO Office", addr: "ceo@rnicrosoft.com", subject: "Urgent Payment", body: "Please review: <a href='#' onmouseover='showTooltip(\"http://rnicrosoft.com/invoice\")' onmouseout='hideTooltip()' onclick='breach()'>Invoice_92.pdf</a>", phishing: true },
        { id: 102, sender: "Apple Cloud", addr: "no-reply@lcloud-apple.com", subject: "Storage Full", body: "<a href='#' onmouseover='showTooltip(\"http://lcloud-apple.com/storage\")' onmouseout='hideTooltip()' onclick='breach()'>Add Space</a>", phishing: true },
        { id: 103, sender: "Finance", addr: "finance@company.com", subject: "Q1 Projections", body: "Attached are the projections.", phishing: false }
    ];

    let emails = { inbox: [], trash: [] }, mode = "guided", score = 0, currentFolder = 'inbox';

    function initSim(m) {
        mode = m; score = 0; updateScore();
        emails.inbox = (mode === 'guided') ? [...GUIDED_DATA] : [...CHALLENGE_DATA];
        emails.trash = [];
        document.getElementById('introOverlay').classList.add('hidden');
        renderList();
    }

    function switchFolder(folder) {
        currentFolder = folder;
        document.getElementById('nav-inbox').classList.toggle('active', folder === 'inbox');
        document.getElementById('nav-trash').classList.toggle('active', folder === 'trash');
        renderList();
    }

    function showReselect() {
        document.getElementById('introOverlay').classList.remove('hidden');
        document.getElementById('completeBtn').style.display = 'none';
    }

    function showTooltip(url, desc = "") {
        document.getElementById('tooltip-url').innerText = `DESTINATION: ${url}`;
        const descEl = document.getElementById('tooltip-desc');
        if (mode === 'guided') {
            descEl.innerText = `ANALYTICS: ${desc}`;
            descEl.style.display = 'block';
        } else {
            descEl.style.display = 'none';
        }
        document.getElementById('link-tooltip').style.display = 'block';
    }

    function hideTooltip() { document.getElementById('link-tooltip').style.display = 'none'; }

    window.addEventListener('mousemove', (e) => {
        let x = e.clientX + 20, y = e.clientY + 20;
        if (x + 300 > window.innerWidth) x = e.clientX - 320;
        document.getElementById('link-tooltip').style.left = x + 'px';
        document.getElementById('link-tooltip').style.top = y + 'px';
    });

    function renderList() {
        const list = document.getElementById('emailList');
        list.innerHTML = emails[currentFolder].map(e => `
            <div class="email-row ${e.read ? '' : 'unread'} ${mode === 'guided' && e.phishing && currentFolder === 'inbox' ? 'highlight' : ''}" onclick="openEmail(${e.id})">
                <input type="checkbox">
                <div style="font-size: 14px;">â˜…</div>
                <div>${e.sender}</div>
                <div style="color:#888; font-size:10px; text-align:right;">10:41 PM</div>
            </div>`).join('');
        checkWin();
    }

    function openEmail(id) {
        const e = emails[currentFolder].find(item => item.id === id);
        if(!e) return;
        e.read = true; renderList();
        document.getElementById('emailView').innerHTML = `
            <h2>${e.subject}</h2><p>From: <b>${e.sender}</b> (${e.addr})</p><hr style="margin:15px 0; border-top:1px solid #eee;">
            <div style="min-height:100px; font-size:15px;">${e.body}</div>
            <div class="actions">
                <button class="btn-ui btn-trash" onclick="move(${id})">Move to Quarantine</button>
                <button class="btn-ui btn-report" onclick="report(${id})">Report Phishing</button>
            </div>`;
    }

    function move(id) {
        const emailIdx = emails[currentFolder].findIndex(e => e.id === id);
        emails.trash.push(emails[currentFolder][emailIdx]);
        emails[currentFolder].splice(emailIdx, 1);
        renderList(); document.getElementById('emailView').innerHTML = "[ Packet Moved to Quarantine ]";
    }

    function report(id) {
        const e = emails[currentFolder].find(item => item.id === id);
        if(e.phishing) { score += 20; log("THREAT NEUTRALIZED", "var(--accent)"); }
        else { score -= 15; log("FALSE POSITIVE", "var(--red)"); }
        emails[currentFolder] = emails[currentFolder].filter(item => item.id !== id);
        updateScore(); renderList();
        document.getElementById('emailView').innerHTML = "[ Analysis Logged ]";
    }

    function breach() {
        score -= 50; updateScore();
        log("CRITICAL BREACH!", "var(--red)");
        setTimeout(() => {
            document.getElementById('introOverlay').classList.remove('hidden');
        }, 800);
    }

    function checkWin() {
        if (emails.inbox.length === 0 && score > 0) {
            document.getElementById('completeBtn').style.display = 'block';
            document.getElementById('introOverlay').classList.remove('hidden');
        }
    }

    function updateScore() { document.getElementById('scoreDisplay').innerText = score; }
    function log(msg, color) {
        const logBox = document.getElementById('lootLog');
        logBox.innerHTML = `<div style="color:${color}">[${new Date().toLocaleTimeString()}] ${msg}</div>` + logBox.innerHTML;
    }

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('bgCanvas'), alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    const geo = new THREE.BufferGeometry();
    const pos = [];
    for(let i=0; i<300; i++) pos.push(THREE.MathUtils.randFloatSpread(100), THREE.MathUtils.randFloatSpread(100), THREE.MathUtils.randFloatSpread(100));
    geo.setAttribute('position', new THREE.Float32BufferAttribute(pos, 3));
    const points = new THREE.Points(geo, new THREE.PointsMaterial({ color: 0x09eef5, size: 0.1 }));
    scene.add(points); camera.position.z = 50;
    function animate() { requestAnimationFrame(animate); points.rotation.y += 0.001; renderer.render(scene, camera); }
    animate();
</script>
</body>
</html>
