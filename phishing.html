<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Security Awareness Inbox</title>
<style>
* { box-sizing: border-box; font-family: Arial, sans-serif; }
body { margin: 0; background: #f3f5f8; }

.topbar {
  height: 56px;
  background: #0f172a;
  color: white;
  display: flex;
  align-items: center;
  padding: 0 16px;
}

.container {
  display: flex;
  height: calc(100vh - 56px);
}

.sidebar {
  width: 220px;
  background: white;
  border-right: 1px solid #ddd;
  padding: 12px;
}

.sidebar div {
  padding: 10px 12px;
  border-radius: 6px;
  cursor: pointer;
  margin-bottom: 6px;
}

.sidebar .active,
.sidebar div:hover {
  background: #e6ecff;
}

.email-area {
  flex: 1;
  display: flex;
}

.email-list {
  width: 45%;
  background: white;
  border-right: 1px solid #ddd;
  overflow-y: auto;
}

.email-row {
  display: grid;
  grid-template-columns: 32px 32px 160px 1fr 70px;
  padding: 10px;
  border-bottom: 1px solid #eee;
  cursor: pointer;
  align-items: center;
}

.email-row.unread { background: #f8fbff; font-weight: bold; }
.email-row:hover { background: #eef3ff; }
.email-row.highlight { background: #fff5b1; }

.star {
  color: #ccc;
  font-size: 18px;
  cursor: pointer;
}
.star.active { color: #f5b301; }

.time {
  font-size: 12px;
  color: #666;
  text-align: right;
}

.email-view {
  flex: 1;
  padding: 16px;
  background: #fafafa;
}

.actions button {
  padding: 10px 14px;
  border: none;
  border-radius: 6px;
  margin-right: 8px;
  cursor: pointer;
}
.delete { background: #6b7280; color: white; }
.report { background: #dc2626; color: white; }

.overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.6);
  display: none;
  align-items: center;
  justify-content: center;
}

.modal {
  background: white;
  padding: 20px;
  width: 90%;
  max-width: 440px;
  border-radius: 8px;
}

.fake-site { text-align: center; }

.loading {
  font-weight: bold;
  color: #dc2626;
}

.intro {
  background: #e6ecff;
  padding: 12px;
  border-bottom: 1px solid #ddd;
  font-size: 14px;
}

.endpoint {
  position: fixed;
  inset:0;
  background: rgba(0,0,0,0.7);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:50;
}
.endpoint .modal { width: 90%; max-width: 400px; text-align:center; }
.endpoint button {
  margin: 10px 0;
  width:100%;
  padding:12px;
  border:none;
  border-radius:6px;
  font-weight:bold;
  cursor:pointer;
}
.continue { background:#22c55e; color:white; }
.exit { background:#ef4444; color:white; }

#introOverlay {
  display:flex;
  background: rgba(0,0,0,0.9);
  justify-content:center;
  align-items:center;
  z-index:100;
}
#introOverlay .modal {
  max-width:600px;
  text-align:left;
  background:#111;
  color:#fff;
  border-radius:10px;
  padding:30px;
  line-height:1.5;
}
#introOverlay h2 { color:#ffcc00; }
#introOverlay button {
  margin-top:20px;
  width:100%;
  padding:15px;
  background:#3b82f6;
  color:white;
  font-weight:bold;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
#introOverlay .warning {
  background:#330000;
  padding:10px;
  border-left:5px solid #ff4444;
  margin:15px 0;
}

@media (max-width: 860px) {
  .container {
    flex-direction: column;
    height: auto;
  }
  .sidebar {
    width: 100%;
    display: flex;
    overflow-x: auto;
    padding: 8px;
  }
  .sidebar div {
    flex: 1;
    margin-right: 6px;
    white-space: nowrap;
  }
  .email-area {
    flex-direction: column;
    height: calc(100vh - 56px - 64px);
  }
  .email-list {
    width: 100%;
    height: 45%;
  }
  .email-view {
    height: 55%;
    overflow-y: auto;
  }
}
</style>
</head>
<body>

<!-- INTRODUCTION OVERLAY -->
<div class="overlay" id="introOverlay">
  <div class="modal">
    <h2>âš  Security Awareness Training</h2>
    <p>Welcome to this <strong>phishing email simulation</strong>. Your goal is to identify potentially malicious emails and report them without mistakenly marking legitimate emails.</p>
    <div class="warning"><strong>Warning:</strong> Clicking on suspicious links in this simulation will demonstrate how attackers collect information.</div>
    <h3>Choose Mode:</h3>

    <button onclick="selectMode('guided')">Guided Mode</button>
    <button onclick="selectMode('challenge')">Challenge Mode</button>

    <div id="modeDesc" style="margin-top:15px;"></div>
  </div>
</div>

<div class="topbar">
  <strong>Security Awareness Inbox</strong>
  <button id="backDifficulty" style="margin-left:auto;padding:6px 12px;border:none;border-radius:6px;background:#3b82f6;color:white;cursor:pointer;display:none;" onclick="showDifficulty()">Back to Difficulty</button>
  <button style="margin-left:8px;padding:6px 12px;border:none;border-radius:6px;background:#f59e0b;color:white;cursor:pointer;" onclick="goToSimulationSelection()">
    Back to Simulation Selection
  </button>
</div>

<div class="intro">
This is a <strong>simulation of phishing emails</strong>. Analyze the messages carefully before taking action. Your goal is to identify and report all potential phishing attempts without mistakenly reporting legitimate emails.
</div>

<div class="container">
  <div class="sidebar">
    <div class="active" onclick="switchFolder('inbox', this)">Inbox</div>
    <div onclick="switchFolder('starred', this)">Starred</div>
    <div onclick="switchFolder('spam', this)">Spam</div>
    <div onclick="switchFolder('trash', this)">Trash</div>
  </div>

  <div class="email-area">
    <div class="email-list" id="emailList"></div>
    <div class="email-view" id="emailView">
      <p>Select an email and decide how to respond.</p>
    </div>
  </div>
</div>

<!-- POPUPS -->
<div class="overlay" id="popup">
  <div class="modal">
    <h3 id="popupTitle"></h3>
    <p id="popupText"></p>
    <button onclick="closeAll()">Close</button>
  </div>
</div>

<div class="overlay" id="reportModal">
  <div class="modal">
    <h3>Report Message</h3>
    <label>Report Type</label><br>
    <select id="reportType">
      <option>Suspicious Email</option>
      <option>Phishing Attempt</option>
      <option>Malware</option>
    </select><br><br>
    <label>Reason</label><br>
    <select id="reportReason">
      <option>Urgency or threats</option>
      <option>Suspicious link</option>
      <option>Unknown sender</option>
    </select><br><br>
    <label>Additional explanation (optional)</label><br>
    <textarea id="reportNotes" rows="3" style="width:100%"></textarea>
    <button onclick="submitReport()">Submit Report</button>
  </div>
</div>

<div class="overlay" id="fakeSite">
  <div class="modal fake-site">
    <h3>Account Verification</h3>
    <p>Processing requestâ€¦</p>
    <p class="loading" id="loadingText"></p>
  </div>
</div>

<!-- ENDPOINT -->
<div class="endpoint" id="endpoint">
  <div class="modal">
    <h3>Simulation Complete</h3>
    <p>You have completed this phishing simulation.</p>
    <button class="continue" onclick="goToMain()">Continue to Main Page</button>
    <button class="exit" onclick="exitSimulation()">Exit</button>
  </div>
</div>

<script>
let mode = "guided";
let guidedIndex = 0;

function selectMode(m) {
  mode = m;
  document.getElementById('introOverlay').style.display = 'none';
  document.getElementById('backDifficulty').style.display = 'inline-block';

  document.getElementById("modeDesc").innerText = mode === "guided"
    ? "Guided mode: Next phishing email will be highlighted in yellow."
    : "Challenge mode: No hints. Find phishing emails on your own.";

  renderList();
  if (mode === "guided") {
    highlightNextPhishing();
  }
}

// --- EMAIL DATA ---
let folders = {
  inbox: [
    { sender: "IT Security Ops", subject: "Unusual Login Detected", body: `<p>During a recent automated security assessment, unusual activity was detected on your account...</p><p>ðŸ‘‰ <a href="#" onclick="openFakeSite()">Verify account security</a></p>`, phishing: true, read: false },
    { sender: "HR Dept", subject: "Remote Work Guidelines", body: `<p>Hello,</p><p>Human Resources has published updates...</p>`, phishing: false, read: false },
    { sender: "Bank Fraud Alert", subject: "Suspicious Transaction Detected", body: `<p>Dear Customer,</p><p>To ensure your account remains secure, please review:</p><p>ðŸ‘‰ <a href="#" onclick="openFakeSite()">Review transaction details</a></p>`, phishing: true, read: false },
    { sender: "Finance Dept", subject: "Invoice Confirmation", body: `<p>Hello,</p><p>Payment has been successfully processed...</p>`, phishing: false, read: false }
  ],
  starred: [
    { sender: "Microsoft 365 Team", subject: "Mailbox Almost Full", body: `<p>Your mailbox is at 98% capacity...</p><p>ðŸ‘‰ <a href="#" onclick="openFakeSite()">Review mailbox storage options</a></p>`, phishing: true, read: false },
    { sender: "Learning Platform", subject: "Course Certificate Ready", body: `<p>Congratulations,</p><p>Your certificate is available for download.</p>`, phishing: false, read: false }
  ],
  spam: [
    { sender: "Cheap Meds Online", subject: "Buy meds at 90% off!", body: `<p>Special limited offer!</p>`, phishing: true, read: false },
    { sender: "Lottery Winner", subject: "You've Won $1,000,000!", body: `<p>Claim your prize immediately!</p>`, phishing: true, read: false }
  ],
  trash: []
};

let currentFolder = 'inbox';
let selectedEmail = null;

const emailList = document.getElementById('emailList');
const emailView = document.getElementById('emailView');

function getAllEmails() {
  return [].concat(folders.inbox, folders.starred, folders.spam);
}

function renderList() {
  emailList.innerHTML = '';
  folders[currentFolder].forEach((email, index) => {
    const row = document.createElement('div');
    row.className = 'email-row ' + (email.read ? '' : 'unread');

    row.innerHTML = `
      <input type="checkbox">
      <div class="star ${currentFolder==='starred'?'active':''}">â˜…</div>
      <div>${email.sender}</div>
      <div>${email.subject}</div>
      <div class="time">Today</div>
    `;

    row.onclick = () => openEmail(email, index, row);

    row.querySelector('.star').onclick = e => {
      e.stopPropagation();
      e.target.classList.toggle('active');
      if (row.querySelector('.star').classList.contains('active') && !folders.starred.includes(email)) {
        folders.starred.push(email);
      } else {
        folders.starred = folders.starred.filter(em => em!==email);
      }
    };

    emailList.appendChild(row);
  });

  if (mode === "guided") {
    highlightNextPhishing();
  }
}

function openEmail(email, index, row) {
  email.read = true;
  row.classList.remove('unread');
  selectedEmail = { email, index };

  emailView.innerHTML = `
    <h2>${email.subject}</h2>
    <p><strong>From:</strong> ${email.sender}</p>
    <hr>
    ${email.body}
    <div class="actions">
      <button class="delete" onclick="deleteEmail()">Delete</button>
      <button class="report" onclick="reportEmail()">Report</button>
    </div>
  `;
}

function deleteEmail() {
  const { email, index } = selectedEmail;
  folders.trash.push(email);
  folders[currentFolder].splice(index,1);
  selectedEmail = null;
  renderList();
  emailView.innerHTML = `<p>Email moved to Trash.</p>`;
  checkCompletion();
}

function reportEmail() {
  document.getElementById('reportModal').style.display = 'flex';
}

function submitReport() {
  const { email, index } = selectedEmail;

  if (mode === "guided") {
    const next = getNextPhishing();
    if (!next || email.subject !== next.subject) {
      showPopup("Wrong email", "This is not the highlighted phishing email. Report the yellow one.");
      return;
    }
  }

  folders[currentFolder].splice(index,1);
  selectedEmail = null;
  renderList();
  emailView.innerHTML = `<p>Email reported successfully.</p>`;
  closeAll();
  checkCompletion();
}

function switchFolder(folder, el) {
  currentFolder = folder;
  document.querySelectorAll('.sidebar div').forEach(d=>d.classList.remove('active'));
  el.classList.add('active');
  renderList();
  emailView.innerHTML = `<p>Select an email and decide how to respond.</p>`;
  checkCompletion();
}

function getNextPhishing() {
  return getAllEmails().find(e => e.phishing);
}

function highlightNextPhishing() {
  const next = getNextPhishing();
  document.querySelectorAll('.email-row').forEach(row => row.classList.remove('highlight'));

  if (!next) return;

  folders[currentFolder].forEach((email, idx) => {
    if (email.subject === next.subject && email.phishing) {
      document.querySelectorAll('.email-row')[idx]?.classList.add('highlight');
    }
  });
}

function openFakeSite() {
  document.getElementById('fakeSite').style.display = 'flex';
  const t = document.getElementById('loadingText');
  t.textContent = "Collecting credentialsâ€¦";
  setTimeout(() => t.textContent = "Uploading dataâ€¦", 1500);
  setTimeout(() => {
    closeAll();
    showPopup("Account Compromised","Your information has been collected without permission. This simulates a phishing attack.");
  }, 3000);
}

function showPopup(title,text) {
  document.getElementById('popupTitle').textContent = title;
  document.getElementById('popupText').textContent = text;
  document.getElementById('popup').style.display = 'flex';
}

function closeAll() {
  document.querySelectorAll('.overlay').forEach(o=>o.style.display='none');
}

function checkCompletion() {
  const phishingRemaining = getAllEmails().some(e => e.phishing);
  if (!phishingRemaining) {
    document.getElementById('endpoint').style.display = 'flex';
  }
}

function goToMain() {
  window.location.href = 'index.html';
}
function exitSimulation() {
  document.body.innerHTML = "<h2 style='padding:40px;text-align:center'>Simulation ended. You may close this window.</h2>";
}

function showDifficulty() {
  document.getElementById('introOverlay').style.display = 'flex';
  document.getElementById('backDifficulty').style.display = 'none';
}

// --- NEW FUNCTION ---
function goToSimulationSelection() {
  window.location.href = 'solutions.html';
}
</script>

</body>
</html>

