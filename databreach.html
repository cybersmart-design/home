<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Breach Simulator â€“ Defender Side</title>
<style>
body {
  background:#0b0f14;
  color:#c9d1d9;
  font-family:monospace;
  padding:16px;
  margin:0;
}

#terminal {
  background:#010409;
  border:1px solid #30363d;
  padding:12px;
  height:55vh;
  max-height:420px;
  overflow-y:auto;
  border-radius:8px;
}

input {
  width:100%;
  background:#010409;
  color:#58a6ff;
  border:1px solid #30363d;
  padding:12px;
  margin-top:12px;
  caret-color:#58a6ff;
  border-radius:8px;
  font-size:16px;
}

.alert { color:#ff7b72; }
.warn { color:#f2cc60; }
.success { color:#3fb950; }
.system { color:#8b949e; }
.info { color:#58a6ff; }

#statusBar {
  margin: 12px 0;
  display:flex;
  justify-content:space-between;
  gap:12px;
}

.statusBox {
  background:#010409;
  border:1px solid #30363d;
  padding:10px;
  border-radius:8px;
  width: 32%;
}

.statusBox strong { display:block; font-size:14px; margin-bottom:6px; }

.progress {
  height:10px;
  background:#30363d;
  border-radius:6px;
  overflow:hidden;
}
.progress > div {
  height:100%;
  background:#58a6ff;
}

.bad {
  background:#ef4444 !important;
}
.warnbar {
  background:#f2cc60 !important;
}
.good {
  background:#22c55e !important;
}

/* Modal */
.modal-bg {
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.85);
  display: flex; justify-content:center; align-items:center;
  z-index: 999;
}
.modal {
  background:#0b0f14;
  border: 1px solid #30363d;
  padding: 20px;
  width: 92%;
  max-width: 520px;
  font-family: monospace;
  color: #c9d1d9;
  border-radius:10px;
}
.btn {
  margin-top: 10px;
  padding: 12px 14px;
  background:#58a6ff;
  border:none;
  color:#0b0f14;
  font-weight:bold;
  cursor:pointer;
  width:100%;
  border-radius:8px;
}
.btn:hover { background:#2f6fa6; }

.btn-success { background:#22c55e; }
.btn-fail { background:#ef4444; }
.btn-warning { background:#f2cc60; color:#0b0f14; }

h2 { margin:0 0 12px 0; font-size:18px; }

#backDifficulty {
  position: fixed;
  top: 16px;
  right: 16px;
  padding: 8px 12px;
  background:#58a6ff;
  color:#0b0f14;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
  display:none;
}
#backDifficulty:hover { background:#2f6fa6; }
</style>
</head>

<body>

<h2>ðŸ›¡ Data Breach Investigation Console</h2>

<button id="backDifficulty" onclick="showDifficulty()">Back to Difficulty</button>

<!-- INTRO / MODE SELECTION -->
<div class="modal-bg" id="introModal">
  <div class="modal">
    <h3>âš  Simulation Notice</h3>
    <p>This is <strong>NOT a real security system</strong>. It is a <strong>simulation for training</strong> and awareness only.</p>
    <p>Choose a mode and role below:</p>

    <button class="btn" onclick="selectMode('guided')">Guided Mode</button>
    <button class="btn" onclick="selectMode('challenge')">Challenge Mode</button>

    <p style="margin-top: 12px; color:#8b949e;">
      Guided mode = easier + hints.<br>
      Challenge mode = harder + no hints.
    </p>

    <hr style="border:1px solid #30363d; margin:12px 0;">

    <p style="color:#8b949e;">Choose your role:</p>
    <button class="btn btn-warning" onclick="selectRole('SOC Analyst')">SOC Analyst</button>
    <button class="btn btn-warning" onclick="selectRole('Incident Responder')">Incident Responder</button>
    <button class="btn btn-warning" onclick="selectRole('Forensic Investigator')">Forensic Investigator</button>
  </div>
</div>

<div id="statusBar">
  <div class="statusBox">
    <strong>Threat Level</strong>
    <div class="progress"><div id="threatBar"></div></div>
    <span id="threatText">LOW</span>
  </div>
  <div class="statusBox">
    <strong>Timer</strong>
    <div class="progress"><div id="timerBar"></div></div>
    <span id="timerText">--:--</span>
  </div>
  <div class="statusBox">
    <strong>Score</strong>
    <div class="progress"><div id="scoreBar"></div></div>
    <span id="scoreText">0</span>
  </div>
</div>

<!-- Network visualization -->
<div class="statusBox" style="width:100%; margin-bottom:12px;">
  <strong>Network Diagram</strong>
  <div style="font-size:12px; line-height:1.5; color:#8b949e;">
    [Internet] â†’ [Firewall] â†’ [DMZ] â†’ [CorpNet] â†’ [Endpoints]
  </div>
</div>

<div id="terminal"></div>
<input id="cmd" placeholder="command@security-console$">

<!-- SUCCESS / FAIL POPUP -->
<div class="modal-bg" id="resultModal" style="display:none;">
  <div class="modal">
    <h3 id="resultTitle"></h3>
    <p id="resultText"></p>

    <!-- Success -->
    <button class="btn btn-success" id="completeBtn" style="display:none;" onclick="completeSimulation()">Complete</button>

    <!-- Fail -->
    <button class="btn btn-success" id="tryAgainBtn" style="display:none;">Try Again</button>
    <button class="btn btn-fail" id="exitBtn" style="display:none;" onclick="exitSimulation()">Exit</button>
  </div>
</div>

<script>
const term = document.getElementById("terminal");
const cmd = document.getElementById("cmd");
const backBtn = document.getElementById("backDifficulty");

let busy = false;
let score = 0;
let mode = null;
let role = null;
let completed = false;

let threat = 0;
let timer = 0;
let phase = 1;

let timerInterval = null;
let hintTimeout = null;

const roleCommands = {
  "SOC Analyst": ["audit access logs", "inspect outbound connections", "check database queries", "help", "clear", "score"],
  "Incident Responder": ["containment", "scan endpoints", "isolate host", "help", "clear", "score"],
  "Forensic Investigator": ["collect memory dump", "analyze disk image", "review event logs", "help", "clear", "score"]
};

function log(msg, cls="system") {
  const d = document.createElement("div");
  d.className = cls;
  d.textContent = msg;
  term.appendChild(d);
  term.scrollTop = term.scrollHeight;
}

function setThreat(delta) {
  threat = Math.max(0, Math.min(100, threat + delta));
  document.getElementById("threatBar").style.width = threat + "%";
  document.getElementById("threatText").textContent =
    threat < 35 ? "LOW" :
    threat < 70 ? "MEDIUM" :
    threat < 90 ? "HIGH" : "CRITICAL";

  document.getElementById("threatBar").className =
    threat < 35 ? "good" :
    threat < 70 ? "warnbar" :
    threat < 90 ? "bad" : "bad";

  // NEW: auto-fail on critical
  if (threat >= 90 && !completed) {
    fail("CRITICAL THREAT LEVEL: Simulation failed. Breach escalated.");
  }
}

function setScore(delta) {
  score = Math.max(0, score + delta);
  document.getElementById("scoreBar").style.width = Math.min(100, score) + "%";
  document.getElementById("scoreText").textContent = score;
}

function setTimer(seconds) {
  timer = seconds;
  updateTimerDisplay();
  if (timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    timer--;
    updateTimerDisplay();
    if (timer <= 0) {
      clearInterval(timerInterval);
      fail("TIME OUT: Breach escalated and data was exfiltrated.");
    }
  }, 1000);
}

function updateTimerDisplay() {
  const min = Math.floor(timer / 60);
  const sec = timer % 60;
  document.getElementById("timerText").textContent =
    `${String(min).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;

  const pct = Math.max(0, Math.min(100, (timer / (mode === 'guided' ? 360 : 240)) * 100));
  document.getElementById("timerBar").style.width = pct + "%";
  document.getElementById("timerBar").className =
    pct > 60 ? "good" : pct > 30 ? "warnbar" : "bad";
}

function stream(lines, done, speed=120) {
  busy = true;
  cmd.disabled = true;
  let i = 0;
  const t = setInterval(() => {
    if (i >= lines.length) {
      clearInterval(t);
      busy = false;
      cmd.disabled = false;
      cmd.focus();
      if (done) done();
      return;
    }
    log(lines[i]);
    i++;
  }, speed);
}

function selectMode(m) {
  mode = m;
  if (!role) role = "SOC Analyst"; // default
  document.getElementById("introModal").style.display = "none";
  backBtn.style.display = "inline-block";
  startConsole();
}

function selectRole(r) {
  role = r;
  log("Role selected: " + role, "info");
}

function startConsole() {
  term.innerHTML = "";
  score = 0;
  completed = false;
  phase = 1;
  threat = 10;

  setThreat(0);
  setScore(0);
  setTimer(mode === "guided" ? 360 : 240);

  log("security-console@corpnet:~$ monitoring enabled");
  log("Mode: " + mode.toUpperCase());
  log("Role: " + (role || "Not selected"));
  log("Type 'help' for commands.");
  cmd.focus();

  if (hintTimeout) clearTimeout(hintTimeout);
  if (mode === "guided") {
    hintTimeout = setTimeout(() => {
      log("HINT: Start with 'audit access logs' to identify the breach source.", "warn");
    }, 20000);
  }
}

function showResult(success, text) {
  document.getElementById("resultTitle").textContent = success ? "âœ” Simulation Complete" : "âœ– Simulation Failed";
  document.getElementById("resultText").textContent = text;
  document.getElementById("resultModal").style.display = "flex";
  cmd.disabled = true;

  document.getElementById("completeBtn").style.display = success ? "block" : "none";
  document.getElementById("tryAgainBtn").style.display = success ? "none" : "block";
  document.getElementById("exitBtn").style.display = "block";
}

function hideResult() {
  document.getElementById("resultModal").style.display = "none";
  cmd.disabled = false;
  cmd.focus();
}

document.getElementById("tryAgainBtn").onclick = () => {
  hideResult();
  window.location.reload();
};

function completeSimulation() {
  window.location.href = "Simulationpage.html";
}

function exitSimulation() {
  window.location.href = "Simulationpage.html";
}

// FIXED: BACK TO DIFFICULTY
function showDifficulty() {
  if (timerInterval) clearInterval(timerInterval);
  if (hintTimeout) clearTimeout(hintTimeout);

  mode = null;
  role = null;
  completed = false;
  busy = false;
  threat = 0;
  score = 0;
  phase = 1;

  document.getElementById("resultModal").style.display = "none";
  term.innerHTML = "";
  cmd.value = "";
  cmd.disabled = false;

  document.getElementById("introModal").style.display = "flex";
  backBtn.style.display = "none";

  document.getElementById("threatBar").style.width = "0%";
  document.getElementById("timerBar").style.width = "0%";
  document.getElementById("scoreBar").style.width = "0%";
  document.getElementById("threatText").textContent = "LOW";
  document.getElementById("timerText").textContent = "--:--";
  document.getElementById("scoreText").textContent = "0";
}

function fail(text) {
  completed = true;
  showResult(false, text);
  clearInterval(timerInterval);
}

function success(text) {
  completed = true;
  showResult(true, text);
  clearInterval(timerInterval);
}

function advancePhase() {
  phase++;
  if (phase === 2) {
    log("ALERT: Unusual outbound connection detected from DMZ.", "alert");
    setThreat(15);
  }
  if (phase === 3) {
    log("ALERT: Lateral movement detected inside CorpNet.", "alert");
    setThreat(20);
  }
  if (phase === 4) {
    log("ALERT: Data exfiltration in progress!", "alert");
    setThreat(30);
  }
}

function isAllowedCommand(cmd) {
  return roleCommands[role].includes(cmd);
}

cmd.addEventListener("keydown", e => {
  if (e.key !== "Enter") return;
  const input = cmd.value.trim();
  const c = input.toLowerCase();
  cmd.value = "";

  if (!mode) {
    log("Select a mode first.", "alert");
    return;
  }

  if (!role) {
    log("Select a role first.", "alert");
    return;
  }

  if (busy) {
    log("system busy... please wait", "warn");
    return;
  }

  log("> " + input);

  if (completed) {
    log("Simulation already completed. Try again or exit.", "warn");
    return;
  }

  if (!isAllowedCommand(c)) {
    log("command not found (not available for your role)", "alert");
    setThreat(8);
    setScore(-5);
    return;
  }

  if (c === "help") {
    log("Available commands:");
    roleCommands[role].forEach(cmd => log(" - " + cmd));
    return;
  }

  if (c === "clear") {
    term.innerHTML = "";
    startConsole();
    return;
  }

  if (c === "score") {
    log("Current score: " + score, "success");
    return;
  }

  // SOC Analyst commands
  if (role === "SOC Analyst") {
    if (c === "audit access logs") {
      stream([
        "Reading access_log_2026_02_06.log...",
        "User: admin | abnormal read volume detected",
        "MFA disabled on admin account",
        "Suspicious login from RU IP",
        "Generating audit summary..."
      ], () => {
        log("SUCCESS: Unauthorized access identified", "success");
        setScore(mode === "guided" ? 10 : 20);
        setThreat(-5);
        if (phase === 1) advancePhase();
      }, 90);
      return;
    }

    if (c === "inspect outbound connections") {
      stream([
        "Inspecting outbound connections...",
        "Connection to unknown IP 185.22.xxx.xxx detected",
        "Data transfer initiated (large payload)",
        "Tracing route..."
      ], () => {
        log("SUCCESS: Data exfiltration channel identified", "success");
        setScore(mode === "guided" ? 10 : 20);
        setThreat(-4);
        if (phase <= 3) advancePhase();
      }, 90);
      return;
    }

    if (c === "check database queries") {
      stream([
        "Analyzing DB query patterns...",
        "Detected abnormal SELECT volume",
        "Suspicious query: SELECT * FROM customer_data WHERE ...",
        "Correlating with access logs..."
      ], () => {
        log("SUCCESS: Suspicious database activity confirmed", "success");
        setScore(mode === "guided" ? 10 : 20);
        setThreat(-3);
        if (phase <= 2) advancePhase();
      }, 90);
      return;
    }
  }

  // Incident Responder commands
  if (role === "Incident Responder") {
    if (c === "containment") {
      stream([
        "Applying containment...",
        "Isolating infected endpoint...",
        "Blocking outbound connections...",
        "Revoking suspicious admin sessions..."
      ], () => {
        log("SUCCESS: Containment applied", "success");
        setScore(mode === "guided" ? 15 : 25);
        setThreat(-10);
        if (phase >= 4) {
          success("Breach contained. Incident resolved successfully.");
        } else {
          advancePhase();
        }
      }, 90);
      return;
    }

    if (c === "scan endpoints") {
      stream([
        "Scanning endpoints for malicious processes...",
        "Found suspicious process: sys_updater.exe",
        "Process communicating with external IP",
        "Checking file hash..."
      ], () => {
        log("SUCCESS: Infected endpoint identified", "success");
        setScore(mode === "guided" ? 10 : 20);
        setThreat(-3);
        if (phase <= 2) advancePhase();
      }, 90);
      return;
    }

    if (c === "isolate host") {
      stream([
        "Isolating host from network...",
        "Host removed from CorpNet",
        "Firewall rules updated..."
      ], () => {
        log("SUCCESS: Host isolated", "success");
        setScore(mode === "guided" ? 10 : 20);
        setThreat(-5);
        if (phase >= 3) advancePhase();
      }, 90);
      return;
    }
  }

  // Forensic Investigator commands
  if (role === "Forensic Investigator") {
    if (c === "collect memory dump") {
      stream([
        "Collecting memory dump...",
        "Dump saved to secure evidence folder...",
        "Hash generated..."
      ], () => {
        log("SUCCESS: Memory dump collected", "success");
        setScore(mode === "guided" ? 10 : 20);
        setThreat(-2);
      }, 90);
      return;
    }

    if (c === "analyze disk image") {
      stream([
        "Analyzing disk image...",
        "Found malware binary: sys_updater.exe",
        "Evidence: persistence via registry..."
      ], () => {
        log("SUCCESS: Disk analysis complete", "success");
        setScore(mode === "guided" ? 10 : 20);
        setThreat(-3);
      }, 90);
      return;
    }

    if (c === "review event logs") {
      stream([
        "Reviewing event logs...",
        "Multiple failed login attempts detected",
        "Account lockouts triggered",
        "Suspicious process execution logged..."
      ], () => {
        log("SUCCESS: Forensic timeline built", "success");
        setScore(mode === "guided" ? 10 : 20);
        setThreat(-3);
        if (phase === 1) advancePhase();
      }, 90);
      return;
    }
  }

  log("command not found", "alert");
  setThreat(8);
  setScore(-5);
});
</script>

</body>
</html>
