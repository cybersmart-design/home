<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CyberSmart | SIM_CORE v3.1_SCROLL_FIX</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Outfit:wght@900&display=swap" rel="stylesheet" />
    <style>
        :root {
            --bg: #010409;
            --accent: #03fc84;
            --cyan: #09eef5;
            --red: #ff3e3e;
            --panel: rgba(2, 8, 18, 0.9);
            --border: rgba(9, 238, 245, 0.2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        /* FIX: Allow scrolling on body */
        body { 
            background: var(--bg); 
            color: #fff; 
            font-family: 'JetBrains Mono', monospace; 
            overflow-x: hidden;
            overflow-y: auto; 
        }

        #bgCanvas { position: fixed; top: 0; left: 0; z-index: -1; }

        /* --- THE CORE LAYOUT --- */
        .simulator-grid {
            display: grid;
            grid-template-columns: 320px 1fr;
            min-height: 100vh;
            padding: 20px;
            gap: 20px;
        }

        /* Sidebar remains fixed height or grows with content */
        .protocol-sidebar {
            background: var(--panel);
            border: 1px solid var(--border);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .protocol-tab {
            padding: 15px;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: 0.3s;
            position: relative;
            background: rgba(0,0,0,0.3);
        }

        .protocol-tab:hover, .protocol-tab.active {
            background: rgba(9, 238, 245, 0.1);
            border-color: var(--cyan);
        }

        /* --- MAIN VIEWPORT --- */
        .core-viewport {
            background: var(--panel);
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 40px;
            position: relative;
            background-image: linear-gradient(var(--border) 1px, transparent 1px), linear-gradient(90deg, var(--border) 1px, transparent 1px);
            background-size: 50px 50px;
            /* FIX: Ensure container can expand */
            min-height: calc(100vh - 40px);
        }

        .status-header {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
            padding-bottom: 10px;
            margin-bottom: 30px;
            font-size: 10px;
            color: var(--cyan);
        }

        .main-content-split {
            display: grid;
            grid-template-columns: 1.2fr 0.8fr;
            gap: 30px;
            margin-bottom: 40px; /* Space before button */
        }

        .content-display h2 { 
            font-family: 'Outfit', sans-serif; 
            font-size: 3.5rem; 
            margin-bottom: 10px; 
            text-transform: uppercase;
        }

        .solution-box {
            background: rgba(255, 255, 255, 0.02);
            padding: 15px;
            border-left: 3px solid var(--accent);
            margin-bottom: 10px;
        }

        /* --- RIGHT SIDE FEED --- */
        .live-terminal {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            height: 400px; /* Fixed height for terminal */
        }

        #feed-container {
            padding: 15px;
            overflow-y: hidden;
            flex-grow: 1;
            font-size: 11px;
        }

        /* --- BUTTON FIX --- */
        .btn-launch {
            display: block;
            width: 100%;
            padding: 25px;
            background: transparent;
            border: 2px solid var(--accent);
            color: var(--accent);
            text-align: center;
            text-decoration: none;
            font-weight: bold;
            letter-spacing: 5px;
            transition: 0.3s;
            margin-top: auto; /* Pushes to bottom of container */
        }

        .btn-launch:hover { background: var(--accent); color: #000; box-shadow: 0 0 30px var(--accent); }

        /* Glitch Animation */
        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }
        .glitch-text:hover { animation: glitch 0.3s infinite; text-shadow: 2px 0 var(--red), -2px 0 var(--cyan); }
    </style>
</head>
<body>

<canvas id="bgCanvas"></canvas>

<div class="simulator-grid">
    <aside class="protocol-sidebar">
        <h3 style="color: var(--cyan); font-size: 14px; margin-bottom: 10px;">> THREAT_INDEX</h3>
        <div class="protocol-tab active" onclick="loadCore(0)">
            <small>01</small>
            <h4 class="scramble">DATA_BREACH</h4>
        </div>
        <div class="protocol-tab" onclick="loadCore(1)">
            <small>02</small>
            <h4 class="scramble">PHISHING_LINK</h4>
        </div>
        <div class="protocol-tab" onclick="loadCore(2)">
            <small>03</small>
            <h4 class="scramble">MALWARE_X</h4>
        </div>
    </aside>

    <main class="core-viewport">
        <div class="status-header">
            <span>CORE_STATUS: <span id="status-text" style="color: var(--accent);">READY</span></span>
            <span>SYSTEM_TIME: 2026.02.15</span>
        </div>

        <div class="main-content-split">
            <div id="core-content" class="content-display">
                </div>

            <div class="live-terminal">
                <div style="background:var(--border); padding:5px 10px; font-size:9px; color:var(--cyan);">LIVE_CORE_FEED</div>
                <div id="feed-container"></div>
            </div>
        </div>

        <a href="#" id="launch-btn" class="btn-launch glitch-text">INITIALIZE SIMULATION CORE</a>
    </main>
</div>

<script>
    // [Same protocolData from previous response]
    const protocolData = [
        {
            title: "Data Breach",
            desc: "Unauthorized exfiltration of sensitive organizational assets and PII data.",
            solutions: [
                ["MFA_ENFORCE", "Implement 2-factor authentication for terminal entry."],
                ["PATCH_MGMT", "Automated synchronization of system updates."],
                ["ENCRYPTION", "Resting data encrypted via FIPS 140-2 standards."],
                ["AUDIT_LOGS", "Monitoring failed login spikes for brute-force."]
            ],
            feed: ["> Sniffing port 80...", "> Intercepting SQL packet", "!! ALERT: DB EXFIL ATTEMPT"],
            link: "databreach.html",
            color: "#09eef5"
        },
        {
            title: "Phishing",
            desc: "Deceptive social engineering campaigns targeting human vulnerability.",
            solutions: [
                ["DOMAIN_CHECK", "Verification of SPF, DKIM, and DMARC records."],
                ["URL_SCAN", "Automated sandbox detonation of embedded hyperlinks."],
                ["USER_AWARE", "Simulation-based training for character-spoofing."],
                ["REPORT_TOOL", "One-click reporting to IT forensics."]
            ],
            feed: ["> Scanning SMTP...", "> SPF check: PASS", "!! ALERT: SPOOFED DOMAIN"],
            link: "phishing.html",
            color: "#03fc84"
        },
        {
            title: "Malware",
            desc: "Malicious code execution designed for system persistence.",
            solutions: [
                ["SEGMENTATION", "VLAN isolation to prevent lateral spread."],
                ["EDR_DEPLOY", "Detection and Response to kill processes."],
                ["AIR_GAP", "Offline backups for ransomware recovery."],
                ["SANDBOXING", "Running suspicious .exe in virtual environments."]
            ],
            feed: ["> Registry scan...", "> Trojan identified", "!! ALERT: PERSISTENCE ATTEMPT"],
            link: "malwareattack.html",
            color: "#ff3e3e"
        }
    ];

    function scrambleText(element, finalMessage) {
        const chars = "!<>-_\\/[]{}â€”=+*^?#________";
        let iteration = 0;
        const interval = setInterval(() => {
            element.innerText = finalMessage.split("").map((char, index) => {
                if(index < iteration) return finalMessage[index];
                return chars[Math.floor(Math.random() * chars.length)];
            }).join("");
            if(iteration >= finalMessage.length) clearInterval(interval);
            iteration += 1 / 3;
        }, 30);
    }

    let feedInterval;

    function loadCore(index) {
        const data = protocolData[index];
        const display = document.getElementById('core-content');
        const launchBtn = document.getElementById('launch-btn');

        document.querySelectorAll('.protocol-tab').forEach((t, i) => t.classList.toggle('active', i === index));

        display.innerHTML = `
            <h2 id="main-title" class="glitch-text" style="color: ${data.color}">${data.title}</h2>
            <p id="main-desc" style="color: #a3b8cc; font-size: 13px; margin-bottom: 20px;"></p>
            <div class="solution-grid">
                ${data.solutions.map((s, i) => `
                    <div class="solution-box" style="border-left-color: ${data.color}">
                        <strong id="sol-title-${i}" style="color: ${data.color}"></strong>
                        <p id="sol-desc-${i}" style="font-size: 11px; margin-top:5px; color: #a3b8cc;"></p>
                    </div>
                `).join('')}
            </div>
        `;

        scrambleText(document.getElementById('main-title'), data.title);
        scrambleText(document.getElementById('main-desc'), data.desc);
        data.solutions.forEach((s, i) => {
            scrambleText(document.getElementById(`sol-title-${i}`), s[0]);
            scrambleText(document.getElementById(`sol-desc-${i}`), s[1]);
        });

        launchBtn.href = data.link;
        launchBtn.style.borderColor = data.color;
        launchBtn.style.color = data.color;
        startFeed(data.feed, data.color);
    }

    function startFeed(messages, color) {
        const container = document.getElementById('feed-container');
        container.innerHTML = "";
        clearInterval(feedInterval);
        feedInterval = setInterval(() => {
            const msg = messages[Math.floor(Math.random() * messages.length)];
            const line = document.createElement('div');
            line.style.color = msg.includes('!!') ? '#ff3e3e' : color;
            line.innerHTML = `<span style="opacity:0.4">> [${new Date().toLocaleTimeString()}]</span> ${msg}`;
            container.prepend(line);
            if (container.childNodes.length > 10) container.removeChild(container.lastChild);
        }, 1500);
    }

    loadCore(0);

    // Three.js Background
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('bgCanvas'), alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    const geo = new THREE.BufferGeometry();
    const pos = [];
    for(let i=0; i<2000; i++) pos.push(THREE.MathUtils.randFloatSpread(100), THREE.MathUtils.randFloatSpread(100), THREE.MathUtils.randFloatSpread(100));
    geo.setAttribute('position', new THREE.Float32BufferAttribute(pos, 3));
    const mat = new THREE.PointsMaterial({ color: 0x09eef5, size: 0.05, transparent: true, opacity: 0.2 });
    const points = new THREE.Points(geo, mat);
    scene.add(points);
    camera.position.z = 50;
    function animate() { requestAnimationFrame(animate); points.rotation.y += 0.001; renderer.render(scene, camera); }
    animate();
</script>

</body>
</html>
